{% extends 'base.html' %}
{% load static %}
{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/productdetail.css' %}">
    <script src="{% static 'js/product-detail.js' %}"></script>
{% endblock %}
{% block content %}
    <div class="col d-flex flex-column overflow-x-hidden h-100 w-100 p-4" id="content">
        <div class="m-auto h-100 w-100 gap-3 p-3">
            <div class="row container mx-auto flex-wrap w-100 w-lg-75">
                <div class="col-12 col-md-6 h-100 px-3">
                    <div class="d-flex flex-column position-relative w-100">
                        <div class="row d-flex w-100 mx-0" id="slideContainer" style="max-height:300px">
                            {% for image in product.images %}
                                <div class="mySlides d-flex w-100 h-100 justify-content-center align-content-center"
                                     style="max-height: inherit">
                                    <img src="{{ image.image.url }}" style="object-fit: contain">
                                </div>
                            {% endfor %}

                            <!-- Next and previous buttons -->
                            <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                            <a class="next" onclick="plusSlides(1)">&#10095;</a>
                        </div>
                        <div class="row d-flex">
                            <!-- Image text -->
                            <div class="caption-container">
                                <p id="caption"></p>
                            </div>

                            <!-- Thumbnail images -->
                            <div class="row">
                                {% for image in product.images %}
                                    <div class="column">
                                        <img class="demo cursor" src="{{ image.image.url }}" style="width:100%"
                                             onclick="currentSlide(1)" alt="{{ image.name }}">
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 col-md-6 d-flex fit-content flex-wrap px-2">
                    <div class="col-12">
                        <h1 class="primary-color">{{ product.name }}</h1>
                    </div>
                    <div class="col-12">
                        <span class="fa fa-star fa-lg checked"></span>
                        <span class="fa fa-star fa-lg checked"></span>
                        <span class="fa fa-star fa-lg checked"></span>
                        <span class="fa fa-star fa-lg unchecked"></span>
                        <span class="fa fa-star fa-lg unchecked"></span>
                    </div>
                    <div class="col-12 my-2">
                        {% include 'update_favorite.html' %}
                        <p class="primary-color">
                            {{ product.description }}
                        </p>
                    </div>
                    <div class="col-12 d-flex pe-5">
                        <h3 class="col-5 primary-color"><span>Price:</span> ${{ product.price }}</h3>
                        <input class="col-4 btn p-0 btn-primary" type="number" id='quantity' placeholder="Quantity"/>
                    </div>
                    <div class="col-12 d-flex mt-3">
                        <button class="col-12 btn-primary btn" id="add_to_cart"
                                value="{{ product.productId }}">Add To Cart
                        </button>
                    </div>
                    <div>
                        <div class="d-flex mt-3">
{#                            <button class="col-12 btn-primary btn" id="product_review"#}
{#                                    value="{{ product.productId }}">Leave a review!#}
{#                            </button>#}
                        </div>
                        <table class="primary-color">
                            <tr>
                                <th>Name</th>
                                <th>Rating</th>
                                <th>Comment</th>
                                <th>Date</th>
                                {% for r in reviews %}
                                    <tr>
                                        <td>{{ r.reviewerId }}</td>
                                        <td>{{ r.rating }}</td>
                                        <td>{{ r.comment }}</td>
                                        <td>{{ r.reviewDate }}</td>
                                    </tr>
                                {% endfor %}
                            </tr>
                        </table>

                    </div>
                </div>

            </div>
            {% if ordered %}
                <div class="row mx-auto w-100 my-5">
                    <div class="col-6">
                        <h5 class="primary-color my-1">You've previously purchased this product</h5>
                        <button class="col-6 btn-primary btn" id="product_review"
                                    value="{{ product.productId }}">Leave a review!
                        </button>
{#                        <button id="toggle" class="btn btn-md btn-light my-1" onclick="toggleReview()">Write a Review</button>#}
{#                        <div id="reviewDiv" class="position-relative w-100" style="display: none">#}
{#                            <form id="reviewForm">#}
{#                                <label for="subject" class="primary-color"></label>#}
{#                                <input id="subject" type="text" placeholder="Subject"#}
{#                                       class="w-100 p-1 btn-primary" style="border-radius: 5px"/>#}
{#                                <br>#}
{#                                <label for="review" class="primary-color"></label>#}
{#                                <textarea id="review" type="text" rows="4" cols="50" placeholder="Write Review"#}
{#                                          class="w-100 p-1 btn-primary"#}
{#                                          style="border-radius: 5px"></textarea>#}
{#                            </form>#}
{#                            #}
{#                        </div>#}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    <script>
        function toggleReview() {
                let reviewForm = document.getElementById('reviewDiv');
                let leaveReviewBtn = document.getElementById('leaveReviewBtn');

                reviewForm.style.display = reviewForm.style.display === 'none' ? 'block' : 'none';
                reviewForm.disabled = !reviewForm.disabled;
                leaveReviewBtn.innerHTML = leaveReviewBtn.innerHTML === 'Write a Review' ? 'Cancel' : 'Write a Review';
            }

        // Define a function to handle the button click event
        function redirectToReviewPage() {
            // Get the product ID from the button's value attribute
            var productId = document.getElementById('product_review').value;

            // Construct the URL for redirection
            var redirectUrl = '/review-product/' + productId;

            // Redirect the browser to the constructed URL
            window.location.href = redirectUrl;
        }

        // Attach the redirectToReviewPage function to the button's click event
        document.getElementById('product_review').addEventListener('click', redirectToReviewPage);
    </script>
{#    <script src="{% static 'js/product-detail.js' %}"></script>#}
{% endblock %}

